---
alwaysApply: true
---

커밋메시지는 한국어로 생성한다.

모듈의 단위는 Business(Application) > Context > Domain 으로 나뉘어진다.

Domain은 가장 작은 단위이며 Repository를 통해 데이터베이스와 직접 데이터를 주고 받고 Service를 통해 데이터를 활용한다.
Domain 모듈은 .module.ts / .repository.ts / .service.ts 파일로 구성되어 있다.
트랜젝션 관리를 제외한 쿼리옵션들은 Domain 서비스 내에서 목적에 맞는 함수로 구현한다.
여러개의 Domain 사이에 관계설정이 필요하면 중간테이블을 만들어 PK값을 넣어서 관리한다.
필요하다면 중간테이블에 추가 컬럼을 넣을 수 있다.
만들어진 중간테이블도 하나의 Domain 모듈이 된다.

Context는 중간단계이며 여러개의 Domain 모듈을 import해서 하나의 문맥을 만든다.
Context는 여러개의 Context가 상위 Context를 구성할 수 있다.
Context란 어떠한 기능을 만드는데 진행되는 흐름을 뜻한다.
예를들면, 아이디와 비밀번호로 로그인을 하면 JWT 토큰을 반환하는 로그인 기능의 흐름은 다음과 같다.

1. 아이디가 존재하는지 확인한다.
2. 비밀번호가 맞는지 검증한다.
3. 해당 아이디가 활성화 되어있는지 확인한다.
4. 유저정보로 JWT 토큰을 생성한다.
5. JWT 토큰을 반환한다.
   이때 위 단계 하나하나가 Context의 서비스 함수가 된다.
   위 컨텍스트에는 유저 도메인모듈과 토큰 도메인모듈이 주입되어 있을 수 있다.

Context의 서비스 함수는 함수명을 한글로 하여 읽기 쉽게 한다.

Business는 최종단계이며 클라이언트와 직접적으로 통신하는 단계이다.
Business는 여러개의 Context 모듈을 import 해서 클라이언트의 시나리오에 맞게 기능이 동작하도록 구현한다.
Business 모듈에 컨트롤러가 존재하며, 컨트롤러 구현 시 요청 dto와 응답 dto를 생성하여 반드시 적용한다.
컨트롤러 구현 시 반드시 Swagger 문서용 데코레이터를 사용하여 문서화를 한다.
컨트롤러의 응답은 최종적으로 정제된 데이터만 반환한다. (status, message 등 다른 값 금지, 최종데이터가 배열이면 배열 값만 반환)

모든 프롬프트에서 필요하다고 판단되면 Domain 혹은 Context 혹은 Business 모듈들을 새로 만들어서 진행한다.

검증 규칙
검증 레벨을 4단으로 쪼개기
입력/전송(Transport) 검증 – 비즈니스 레이어 가장 바깥
목적: “형식”과 “존재” 확인 (스키마·타입·필수값)
도구: zod / class-validator 등
결과: 깨끗한 DTO로 정규화
실패 시: 400 Bad Request 계열
도메인 불변식(Invariant) 검증 – 도메인 엔티티/VO 내부
목적: 항상 참이어야 하는 규칙(엔티티 일관성)
예: 이메일 포맷, 날짜 범위, 음수가 아닌 수량, 상태 전이 유효성 등
구현: 생성자·팩토리·세터(행위)에서만 상태 변경 허용 + 즉시 검사
실패 시: DomainError (비즈니스로 전파 → 422/409 매핑)
도메인 규칙/정책(Policy) 검증 – 도메인 서비스(순수 로직)
목적: 여러 엔티티/VO에 걸친 규칙 (가격정책, 승인 조건, 중복 정책 등)
구현: 순수 함수/서비스. 외부 I/O는 **포트(Repository 인터페이스)**로 주입
실패 시: DomainPolicyError
컨텍스트/인프라 검증 – 컨텍스트 레이어
목적: 경계 밖 의존성과 얽힌 제약(고유성, 존재 확인, 권한, 일관성, 트랜잭션)
구현: 리포지토리 통해 조회 후 사실 검증, 중복 체크, 권한·잠금 등
실패 시: Conflict/NotFound/Forbidden 등으로 매핑

도메인은 “모르면 안 되는 규칙(항상 성립)”을 스스로 지키고,
컨텍스트는 “외부 상태가 얽힌 사실 검증”을 맡고,
**비즈니스(애플리케이션)**는 흐름/오케스트레이션과 DTO 검증만 담당.
방향: business → context → domain (상위가 하위를 사용)
domain은 위로 의존하지 않음(UI/DB/프레임워크 모름).
외부 시스템 검증(예: 중복 이메일)은 context에서 리포지토리로 확인.
