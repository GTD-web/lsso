# Auth Application Module

기존 라이브 서비스의 API 호환성을 완벽하게 유지하면서 새로운 아키텍처로 마이그레이션된 인증 모듈입니다.

## 🎯 주요 기능

### 1. **시스템 인증** (`authenticateSystem`)

-   Basic Auth 헤더 파싱 및 검증
-   클라이언트 ID/시크릿 검증 (bcrypt 해싱)
-   시스템 활성화 상태 확인

### 2. **로그인 처리** (`handleTokenRequest`)

-   **Grant Type: password** - 이메일/비밀번호 로그인
-   **Grant Type: refresh_token** - 리프레시 토큰 갱신
-   JWT 토큰 생성 및 DB 저장
-   조직 정보 조합

### 3. **토큰 검증** (`verifyToken`)

-   JWT 토큰 검증 (서명, 만료시간)
-   DB 토큰 정보 확인
-   직원 상태 검증

### 4. **비밀번호 관리**

-   **비밀번호 변경** (`changePassword`)
    -   비밀번호 강도 검증
    -   bcrypt 해싱
    -   보안 로그 기록
-   **비밀번호 확인** (`checkPassword`)
    -   bcrypt 비교

## 🔄 실제 구현된 로직

### **로그인 플로우**

```typescript
1. 시스템 인증 (Basic Auth + bcrypt 검증)
2. 직원 조회 (이메일)
3. 비밀번호 검증 (bcrypt 비교)
4. 직원 상태 확인 (Active)
5. JWT 토큰 생성 (액세스 + 리프레시)
6. DB에 토큰 저장/업데이트
7. 조직 정보 조회
8. 로그인 로그 기록
```

### **토큰 검증 플로우**

```typescript
1. JWT 토큰 검증 (서명 + 만료시간)
2. DB에서 토큰 정보 확인
3. 직원 상태 확인
4. 조직 정보 조회
```

### **토큰 갱신 플로우**

```typescript
1. 리프레시 토큰으로 기존 토큰 조회
2. 리프레시 토큰 만료 확인
3. 직원 정보 조회
4. 새 JWT 액세스 토큰 생성
5. DB 토큰 정보 업데이트
6. 조직 정보 조회
```

## 🛠️ 기술 구현 요소

### **JWT 토큰 관리**

-   `JwtUtil`: JWT 토큰 생성/검증
-   액세스 토큰: 24시간 만료
-   리프레시 토큰: 30일 만료
-   GLOBAL_SECRET 환경변수 사용

### **비밀번호 보안**

-   `PasswordUtil`: bcrypt 해싱/검증
-   Salt Rounds: 10
-   비밀번호 강도 검증 (대소문자, 숫자, 특수문자)
-   랜덤 비밀번호 생성 기능

### **토큰 관리 전략**

-   기존 토큰이 있으면 업데이트
-   없으면 새로 생성
-   직원-토큰 관계 테이블 관리

## 📊 로깅 및 감사

### **보안 이벤트 로그**

-   로그인 성공/실패
-   비밀번호 변경
-   토큰 갱신
-   IP 주소 및 User-Agent 기록

## 🔗 Context 의존성

### **SSO Context**

-   `로그인처리하기`: 실제 인증 로직
-   `토큰검증하기`: JWT + DB 검증
-   `비밀번호변경하기`: 보안 비밀번호 변경
-   `비밀번호확인하기`: bcrypt 비교

### **System Management Context**

-   `클라이언트아이디로시스템조회하기`: 시스템 인증
-   `토큰갱신하기`: 리프레시 토큰 처리
-   `리프레시토큰으로토큰조회하기`: 토큰 조회
-   `토큰아이디로직원토큰관계조회하기`: 관계 조회

### **Organization Context**

-   `직원조직정보조회하기`: 부서/직책/직급 정보

## 🎨 API 호환성

모든 기존 API 엔드포인트가 **100% 호환**됩니다:

-   `POST /auth/login` - 로그인 및 토큰 발급
-   `POST /auth/verify` - 토큰 검증
-   `POST /auth/change-password` - 비밀번호 변경
-   `POST /auth/check-password` - 비밀번호 확인

응답 형식, 상태 코드, 에러 메시지 모두 기존과 동일합니다.

## 🚀 성능 및 보안

### **성능 최적화**

-   JWT 토큰 사용으로 DB 조회 최소화
-   조직 정보 선택적 조회 (오류 시 계속 진행)
-   Context 모듈 재사용

### **보안 강화**

-   bcrypt 해싱 (Salt Rounds: 10)
-   JWT 서명 검증
-   비밀번호 강도 검증
-   상세 보안 로그

이제 기존 서비스를 중단하지 않고도 현대적이고 안전한 인증 시스템을 사용할 수 있습니다! 🔐
